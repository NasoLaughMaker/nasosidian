# ENEOSメモ
- 3月からENEOSの保守正規メンバー
- 先方からのお問い合わせ対応が主
- rubyの開発も少しあるかと思う

# MTG 2/7(金) 12:00~
### `load average`監視
  - 以下で報告
    - 上昇傾向
	- 10を超過
- 実施時間：`12:00 ~ 15:00`
- ハドル内容
  - EC2の再起動は意味なさそう
  - ElastiCacheの再起動が必要
    - ElastiCacheのみの再起は実績なし
  - 12:30付近がピークになりそう
  - 15:00以降の業務フロー
    - 許可証の許可漏れ対応
	  - 土日の分もあるため、負荷かかる。15:00以降も監視強化。

### アイレットさん対応のスケールアップ
- 21:30 ~　ハドルあり
  - 昨日と同じソースなので、動作確認は軽微
  - ログイン、メールが飛ぶかなど15分程度でできる範囲（ヴォンさん松本さん対応）
- 22:30完了報告が目標

### 上記以外は通常業務
- 12日の準備
  - 川崎：開発完了
  - 堺：バグ修正中
- developにあげて結合試験
  - 今日完了見込み
  - 前提：既存の動作確認 + 変更範囲の追加テストシナリオ
    - staging：全良　白グレー黄色
    - 本番：最低限　白黄色
	  - 黄色は本番だけのものにピックアップして良い
- デプロイ作業は1時間で完了したい
  - 10分：デプロイ
  - 15〜30分：動作検証
  - 以降報告

# ElastiCache再起動後にログインリセット処理が必要か？14:30~
- 再起動後にも画面が残り続けており、データの更新をかけた際に、意図しない（整合性が取れていない）データが入っている可能性がある。

  - ログイン情報はどこで保存しているか？
    - Redis再起動でキャッシュはクリアされる。ログインセッションのIDもRedisに保存されているのであれば、データの整合性は取れている。
      - ElastiCacheには保存していない。ログイン周りはDBが担っている。(宮川さん)
    	- 整合性の取れていないデータを検知する方法が必要


# 3/10 保全：堺 MTG
- 仕様確認があればbacklogのコメントに記載・ステータス変更
- 明日今月末までのタスクの見積もりを出す必要あり
- 着手するタスクの見積もりを出して欲しい
  - 今日中に出す。
  - 見積もり出す時は開発時間×1.2くらい(検証や反映も込み)


# 3/14(金)
どこの製油所でなんの問題が起きているか
500エラーのいつ修正するのかの確認

### 障害
- 水島
	- 起きている
- 鹿島
	- お
- 堺
	- 起きている
- 川崎
	- 既知のエラーのみ
	- 障害はなし

川崎を参考にして500エラー何番みたいな感じで整理する
	これ何？
	松本さんに確認する

作成したキャンバス
`999`と`valqua-eneos`のキャンバスに転記して


# 3/18 社内MTG
## 堺・川崎分離
- 堺はそのまま
- 川崎を分離
データ移行が必要？

## STGどうなっているか
- 3/17のエラーが解決しないと無理
- 締切21日

## 新事業所
- 麻里布
	- 鹿島ベース
	- 新しいブランチ作る

## タドロスさん
- 折野さんの代替は難しい
- 折野さんの作業を可能な限りリスト化してもらって処理していけるようにする。
	- 役割；金澤さんとの会話・BE実装
- 工数貰えなさそうなので、堺の人数を減らさないといけない

## 2アウト
### 500番エラー
- 優先度関係なく全て27の反映に間に合わせる(予定)
	- 中、低に関しては山邊さん次第
### diskエラー
- チケット作成
- 水島、鹿島、川崎、堺で確認が必要
- 対応の流れ
	- cron止める
	- s3バケット確保
	- cronのスクリプト変更
	- cron再起動

以下を山下さんに調べてもらう
調べた後の連絡は松本さん、千葉さん
- バケットの費用
- 転送の費用
バケットのポリシー
- 1スナップショットいくら


# 3/25 ENEOS会
## デプロイについて
- 川崎・堺のスケールダウンも同時に行う予定になっている。
	- 27日に行いたいが、山邊さんにも話共有されているか？

## サーバー分離
- 川崎・堺の4/10デプロイに合わせて分離したい。
- 麻里布は鹿島を完全に引き継いでいる。アカウントについても引き継がれてるが、追加が必要になればご指示いただきたい。

### 川崎
方針：川崎ユーザーリダイレクト
細かい部分は会話できるようにする。


# 3/25 内部状況確認
## インフラ周りの作業負担分散
千葉さんに負担いってるので、松本さんにボールキャッチをしてもらいたい

## 堺の見積もり
1年分の見積もりをヴォンさんに依頼する

## 宮川さんのENEOS作業
4月以降に宮川さんのENEOS作業を0にしたい。
須川さんに3番に入ってもらうことになるかも。

## 山下さんのインフラ作業
高橋さんの引き継ぎ資料なし

## ENEOSインフラ
### sidekiq問題
永井対応中。
`eneos-stg`で検証する。マルチアプリケーションの対応は必要。
4/10に分離するため、そこにあわせてやっていく。
- [ ] 対応が終わったら千葉さんに連絡する

各事業所ごとに本番・STG・開発を同じ命名規則でやる。
4/10目処で綺麗にしたい。

## 本番反映
### 3/27
- 堺
- 川崎(全体で起きる可能性あり)
- 鹿島

### 4/3
- 川崎

### 4/10
- 川崎サーバー分離

## 金澤さん、山邊さん
slackで連絡して終わりはやめてほしい。
MTGなどを使って連絡してほしい

## S3の状況
今の状況を横展開できるように資料作成
- いつ実行
- どこに保存

## メモリ問題
- ACWのメトリクスに入っていない。
	- ACWエージェントを入れて、各環境のメモリ見れるようにする。
- server ram の値が puma worker killer の値と調整できているのか確認する必要あり。
	- 27の反映でTODOとしておく。

## スケールダウン
遅くなるかも



# 4/1 ENEOS会
- 坂野さん
	- 麻里布メンバーとして参画

## 鹿島のload average問題
27日に上がったが、現状は落ち着いている。

## STEP4の工数出し



# 4/15 朝会
## 17日反映
以下作成
- 根岸STG
- 堺・川崎DEMO環境

## 障害系
- マルチアプリの環境変数設定
- STG容量問題
- backup問題
- access.log.json消す
- RDB

## 環境周り
STGのpublic.pdfいらないのでは？
->永井調査依頼

## 各製油所から
- 第3チーム
	- 4/17以降水島を優先する
- 第2チーム
	- 5/1反映の対応が残り2件で完了
- 第1チーム
	- 

## 計算式
実装・レビューの倍くらいで工数を設定しましょう。
仕様確認 120%
テスト 130%
修正 130%

# 4/16 朝会
## 本番反映
- 堺
	- 今日昼過ぎSTG検証
- 川崎
	- 実装は完了
- 鹿島
	- 16:00 テスト開始できそう
- 水島
	- 本日の検証は難しいかも

## 保守
- 堺
	- お知らせ機能つっぱします。
	- パスワードリセットやユーザー追加に関しては松本さんに投げていいみたい