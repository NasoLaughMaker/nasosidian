- https://github.com/Bee2B/valqua-spm-api/issues/13980
- https://beeb-jp.slack.com/archives/C07TFM397U2/p1739528932227179

### 移行先
コスモ四日市
移行後コスモ四日市に紐付くはず。

どうにかしてメソッド実行を行えるように検証して
polymorphicの実装自体は今ので大丈夫だと思う

- to_aで配列にする
- 計算量をn^2からnに変える

# 2/25(火) 12:20~
- staging環境で全ページ見て移行が完了しているかを確認する
  - 全てを見るのは1日で完了できるかどうか
  - 移行PGが正しいなら後は見なくて良いものがいくつかあるはず。そのパターンは省略する方針で提案したい。
  - その確認方法を永井、小宮さんである程度固めて欲しい。
  - 小宮さん → 永井 → 宮川さんの順で手順報告する。
- シートに確認項目の一覧を作成する

# 作業メモ
- `user_projects`に`projects_id = 55`のユーザー混じってるけど大丈夫？
  - 該当ユーザーは`office_id = 56`も持っており、`user_id`基準で抽出しているからこのようになっている。
 
  
# 移行に伴う、データ数の不一致
- `bolting_user_qr_codes`の移行前と移行後でデータ数が違う
  - 移行後の元データにSQLの条件に一致するデータがあるっぽい？
- `active_storage_blobs`の件数が一致しない
  - 移行後の元データがあるためしゃーなし
- `office_user`
  - 移行後の元データにSQLの条件に一致するデータがある
 
# 検証用シートの関数
`=IF(AND(シート名!A5:AP5='シート名 (2)'!A5:AP5),0,1)`
完全版(かも)
`=IF(AND(INDIRECT("'"&$E$2&"'!A"&ROW()&":BZ"&ROW())=INDIRECT("'"&$E$3&"'!A"&ROW()&":BZ"&ROW())), 0, 1)`

# 検証方法
- No.1 完了
- No.2 完了
- No.3 完了
- No.4 
  - DL機能がバグってるのexcelは使えない。
  - 各項目を網羅できるようにどのデータを見れば良いか調査する。
- No.6
  - `active_storage_attachments`で3種類いたやつ網羅的に確認できるよう、対象とするデータ決める
  - `bolting_work_photo_comments`,`bolting_work_checklist_item_photo_comments`どうする？


### No.4
  - `製造3課 FCC UV-898 M/H　M1`
  - `製造3課 FCC 配管仕 切板挿入箇所`
 
#### 値があるカラム
  - size
    - フランジ寸法 ✅
    - `880`, 881, 882, 883
  - bolt_num
    - Bolt本数 ✅
	- `879`
  - bolt_size ✅
    - Bolt寸法
    - 816, `879`, 880
  - bolt_material ✅
    - Bolt材質
    - `879`
  - released_count
    - 開放回数
	- 0のみ：要確認
    - 816, `879`, 880
  - leak_count
    - 漏えい回数
	- 0のみ
    - 816, `879`, 880
	- `/projects/[project_id]/flanges/[flange_id]/histories`で確認する必要あり？
	- flangesの項目については、No.3で確認できる
  - have_leak_at_last_open
    - 漏れ有
	- 0のみ (boolean)
	- 1だと表示されない可能性高：要確認
    - 816, `879`, 880
  - 要注意
  - 過去履歴

### No.6
- `active_storage_attachments`,`active_storage_blobs`,`bolting_work_checklist_item_photo_comments`の確認
```
SELECT
	*
FROM
	bolting_works
WHERE
	id IN(
		SELECT
			bolting_work_id
		FROM
			bolting_work_checklists
		WHERE
			id IN(
				SELECT
					bolting_work_checklist_id
				FROM
					bolting_work_checklist_categories
				WHERE
					id IN(
						SELECT
							bolting_work_checklist_category_id
						FROM
							bolting_work_checklist_items
						WHERE
							id IN(
								SELECT
									bolting_work_checklist_item_id
								FROM
									bolting_work_checklist_item_photo_comments
								WHERE
									id IN(
										SELECT
											record_id
										FROM
											active_storage_attachments
										WHERE
											record_type IN(
												'BoltingWorkChecklistItemPhotoComment'
											)
									)
								AND
									comment = '円周方向に腐食有
6B下部'

							)
					)
			)
	);
```

