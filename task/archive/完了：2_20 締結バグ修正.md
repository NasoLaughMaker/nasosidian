https://github.com/Bee2B/valqua-spm-api/issues/14057
# TEIKETU-
## 該当データの参照方法
```sql
SELECT
	*
FROM
	offices
WHERE
	id IN(
		SELECT
			office_id
		FROM
			projects
		WHERE
			id IN(
				SELECT
					project_id
				FROM
					local_device_categories
				WHERE
					id IN(
						SELECT
							local_device_category_id
						FROM
							devices
						WHERE
							id IN(
								SELECT
									device_id
								FROM
									model_numbers
								WHERE
									name = 'E-104B'
							)
					)
			)
	);
```

## バグ再現・検証結果
### 正常系
入力済み項目
- 報告書・トラブル/申し送りメモ
- 着工開始
- 協力会社
- プラントオーナー
→ プラントオーナーの承認キャンセル
→ 「着工完了をキャンセルをしてもよろしいですか？」モーダルが表示

### バグ内容
入力済み項目
- 着工開始
- 協力会社
- プラントオーナー
→ プラントオーナーの承認キャンセル
→ 「着工開始をキャンセルをしてもよろしいですか？」モーダルが表示されてしまう。
#### バグ修正内容
- 「着工開始をキャンセルをしてもよろしいですか？」モーダルは表示されない

## 対応内容
- 上記の再現をissueに起票
- どのように修正すれば良いか起票
- Vuさんに連携
  - FrontEndのみで対応可能なため
 


# TEIKETU_PH2-294
### log
```
[dd.env=local dd.service=valqua dd.trace_id=2178976871964310826 dd.span_id=4592742560201965392]   ↳ lib/import_flanges.rb:166:in `block (3 levels) in import'
[dd.env=local dd.service=valqua dd.trace_id=2178976871964310826 dd.span_id=4592742560201965392]   Flange Load (0.3ms)  SELECT `flanges`.* FROM `flanges` WHERE `flanges`.`device_id` IS NULL AND `flanges`.`model_number_id` IS NULL AND `flanges`.`name` = '104A-6' LIMIT 1
[dd.env=local dd.service=valqua dd.trace_id=2178976871964310826 dd.span_id=4592742560201965392]   ↳ lib/import_flanges.rb:136:in `block (3 levels) in import'
[dd.env=local dd.service=valqua dd.trace_id=2178976871964310826 dd.span_id=4592742560201965392]   Flange Exists? (0.2ms)  SELECT 1 AS one FROM `flanges` WHERE `flanges`.`name` = '104A-6' AND `flanges`.`device_id` IS NULL AND `flanges`.`model_number_id` IS NULL LIMIT 1
[dd.env=local dd.service=valqua dd.trace_id=2178976871964310826 dd.span_id=4592742560201965392]   ↳ lib/import_flanges.rb:165:in `block (4 levels) in import'
[dd.env=local dd.service=valqua dd.trace_id=2178976871964310826 dd.span_id=4592742560201965392] flange.valid? = false
[dd.env=local dd.service=valqua dd.trace_id=2178976871964310826 dd.span_id=4592742560201965392]   CACHE Flange Exists? (0.0ms)  SELECT 1 AS one FROM `flanges` WHERE `flanges`.`name` = '104A-6' AND `flanges`.`device_id` IS NULL AND `flanges`.`model_number_id` IS NULL LIMIT 1
[dd.env=local dd.service=valqua dd.trace_id=2178976871964310826 dd.span_id=4592742560201965392]   ↳ lib/import_flanges.rb:165:in `block (4 levels) in import'
[dd.env=local dd.service=valqua dd.trace_id=2178976871964310826 dd.span_id=4592742560201965392]   CACHE Flange Exists? (0.0ms)  SELECT 1 AS one FROM `flanges` WHERE `flanges`.`name` = '104A-6' AND `flanges`.`device_id` IS NULL AND `flanges`.`model_number_id` IS NULL LIMIT 1
```

`import_flanges.rb`
```ruby
if import_draft_flanges
            if @project.system_type.progress_management?
              area = @local_device_category.areas.find { _1.name == area_name }
              device = @local_device_category.devices.find { _1.name == device_name && _1.area_id == area&.id }
            else
              area = areas.find { _1.name == area_name }
              device = devices.find { _1.name == device_name && _1.area_id == area&.id }
            end
            raise InvalidParamaterError, "#{row_count}行目：装置を設定してください。" if device.nil?
            model_number = device&.model_numbers&.find { _1.name == model_number_name }
            raise InvalidParamaterError, "#{row_count}行目：案件に登録されていない機番のフランジが含まれています。登録できるフランジは案件に登録されている機番のもののみです。" if area_name.present? && device_name.present? && model_number_name.present? && (area.nil? || device.nil? || model_number.nil?)
          else
```