# payloadが問題ないサイズか確認する
## 確認方法
1. ログにサイズを出力するよう仕込む。
2. workerを一時的に止め、queueを溜め込んでredis-cliで確認する。
	1. ただこれだと、本番環境の実際の値ではないため、おおよその予測に基づく数値となる。

```ruby
class MyJobLogger
	def call(worker, job, queue)
		payload_size_bytes = job.to_json.bytesize
		job_id = job['jid']
		Rails.logger.info("Sidekiq Job Payload size: #{payload_size_bytes} bytes, Job ID：#{job_id}")
		yield
	end
end

  

Sidekiq.configure_server do |config|
	config.redis = { url: "redis://#{ENV['KVS_HOST']}:6379/#{ENV.prefix_fetch('SIDEKIQ_REDIS_DB', 9)}", namespace: "sidekiq" }
	config.default_job_options = { retry: 5 }
	
	case Rails.env.to_sym
	when :production, :staging
		config.logger = Sidekiq::Logger.new($stdout)
		config.logger.level = Logger::INFO
	when :development
		config.logger = Sidekiq::Logger.new($stdout)
		config.logger.level = Logger::INFO
	when :test
		Sidekiq.logger = nil
	end
	
	config.server_middleware do |chain|
		chain.add MyJobLogger
	end
end

  

Sidekiq.configure_client do |config|
	config.redis = { url: "redis://#{ENV['KVS_HOST']}:6379/#{ENV.prefix_fetch('SIDEKIQ_REDIS_DB', 9)}", namespace: "sidekiq" }
	config.default_job_options = { retry: 5 }
end
```
